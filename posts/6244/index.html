<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>iOS Extentsion 入门实战 - Nevermore</title><meta description="最近需求是App接入 Today Extentsion 组件，因为之前没做过这方面，都是摸着石头过河.以下文章都是基于摸索中遇到问题和一些总结，如果有什么不对，请指教一下~ 1. App Extensions简介1.1 什么是App Extensions从 iOS 8 开始，苹果引入了全新的 App Extension。它是一种扩展，很类似于一些大型软件的插件机制。App Extension 事实"><meta property="og:type" content="blog"><meta property="og:title" content="iOS Extentsion 入门实战"><meta property="og:url" content="https://swlfigo.github.io/posts/6244/"><meta property="og:site_name" content="Nevermore"><meta property="og:description" content="最近需求是App接入 Today Extentsion 组件，因为之前没做过这方面，都是摸着石头过河.以下文章都是基于摸索中遇到问题和一些总结，如果有什么不对，请指教一下~ 1. App Extensions简介1.1 什么是App Extensions从 iOS 8 开始，苹果引入了全新的 App Extension。它是一种扩展，很类似于一些大型软件的插件机制。App Extension 事实"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409160751.png"><meta property="og:image" content="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409160833.png"><meta property="og:image" content="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409165903.png"><meta property="og:image" content="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409170336.png"><meta property="og:image" content="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409170633.png"><meta property="og:image" content="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409172331.png"><meta property="og:image" content="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409172505.png"><meta property="og:image" content="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409173055.png"><meta property="og:image" content="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409173138.png"><meta property="og:image" content="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409173435.png"><meta property="og:image" content="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409173749.png"><meta property="og:image" content="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409174457.png"><meta property="og:image" content="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409215150.png"><meta property="og:image" content="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409215449.png"><meta property="og:image" content="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409220738.png"><meta property="og:image" content="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409220848.png"><meta property="og:image" content="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409221138.png"><meta property="og:image" content="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409221227.png"><meta property="og:image" content="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409221323.png"><meta property="og:image" content="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409184143.png"><meta property="article:published_time" content="2019-04-28T10:49:01.000Z"><meta property="article:modified_time" content="2021-04-12T10:15:44.841Z"><meta property="article:author" content="Sylar"><meta property="article:tag" content="iOS"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409160751.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://swlfigo.github.io/posts/6244/"},"headline":"Nevermore","image":["https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409160751.png","https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409160833.png","https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409165903.png","https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409170336.png","https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409170633.png","https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409172331.png","https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409172505.png","https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409173055.png","https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409173138.png","https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409173435.png","https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409173749.png","https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409174457.png","https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409215150.png","https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409215449.png","https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409220738.png","https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409220848.png","https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409221138.png","https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409221227.png","https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409221323.png","https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409184143.png"],"datePublished":"2019-04-28T10:49:01.000Z","dateModified":"2021-04-12T10:15:44.841Z","author":{"@type":"Person","name":"Sylar"},"description":"最近需求是App接入 Today Extentsion 组件，因为之前没做过这方面，都是摸着石头过河.以下文章都是基于摸索中遇到问题和一些总结，如果有什么不对，请指教一下~ 1. App Extensions简介1.1 什么是App Extensions从 iOS 8 开始，苹果引入了全新的 App Extension。它是一种扩展，很类似于一些大型软件的插件机制。App Extension 事实"}</script><link rel="canonical" href="https://swlfigo.github.io/posts/6244/"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><meta name="generator" content="Hexo 5.1.1"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="Nevermore" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/swlfigo"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-04-28T10:49:01.000Z" title="2019-04-28T10:49:01.000Z">2019-04-28</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-04-12T10:15:44.841Z" title="2021-04-12T10:15:44.841Z">2021-04-12</time></span><span class="level-item"><a class="link-muted" href="/categories/iOS/">iOS</a></span><span class="level-item">26 minutes read (About 3903 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">iOS Extentsion 入门实战</h1><div class="content"><p>最近需求是App接入 <code>Today Extentsion</code> 组件，因为之前没做过这方面，都是摸着石头过河.以下文章都是基于摸索中遇到问题和一些总结，如果有什么不对，请指教一下~</p>
<h1 id="1-App-Extensions简介"><a href="#1-App-Extensions简介" class="headerlink" title="1. App Extensions简介"></a>1. App Extensions简介</h1><h2 id="1-1-什么是App-Extensions"><a href="#1-1-什么是App-Extensions" class="headerlink" title="1.1 什么是App Extensions"></a>1.1 什么是App Extensions</h2><p>从 iOS 8 开始，苹果引入了全新的 App Extension。它是一种扩展，很类似于一些大型软件的插件机制。App Extension 事实上并不是你应用的插件，而是系统的插件，其生命周期是由系统来管理的，所以如果你想做什么坏事还是行不通的…但是 App Extension 分发的载体是应用，也就是说如果你只是单纯想做一个今日面板插件，也需要有个主程序，你的主程序可以什么都不做，也可以提供一些基本的设置和数据。iOS的Extension包括以下:</p>
<p><img src="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409160751.png"></p>
<p><img src="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409160833.png"></p>
<p>文章用到的是 <code>Today Extension</code>,用于 iPhone 的今日插件</p>
<a id="more"></a>

<h2 id="1-2-App-Extension-和主程序的关系"><a href="#1-2-App-Extension-和主程序的关系" class="headerlink" title="1.2 App Extension 和主程序的关系"></a>1.2 App Extension 和主程序的关系</h2><p>可以说没有什么关系，基本上就是两个独立的程序，你的主程序既不可以访问 App Extension 的代码，也不可以访问其存储空间，这完完全全就是<strong>两个进程</strong>、<strong>两个程序</strong>。</p>
<h2 id="1-3-App-Extension-可以干什么？不可以干什么？"><a href="#1-3-App-Extension-可以干什么？不可以干什么？" class="headerlink" title="1.3 App Extension 可以干什么？不可以干什么？"></a>1.3 App Extension 可以干什么？不可以干什么？</h2><p>基本上什么都能干,但是内存有限制，App Extension 的可用内存远不如常规应用。也不能执行长时间的操作，你的 <code>App Extension</code> 可能随时被系统 Kill 掉,因为 <code>App Extension</code> 是由系统管理生命周期的。最后一些API也是不能用，一部分如下：</p>
<ul>
<li>不能使用 sharedApplication 对象及其其中的方法。</li>
<li>使用NS_EXTENSION_UNAVAILABLE 宏在头文件中标记的任意API或类似的不可用的宏或API在一个不可用的框架中。例如，在iOS 8.0中，the HealthKit framework and EventKit UI framework 将不能使用app extension.</li>
<li>不能在iOS设备中使用相机和麦克风(不像其他app extensions，iMessage app可以访问这些资源，只有它正确的配置 NSCameraUsageDescription and NSMicrophoneUsageDescription Info.plist 文件中的Key)。</li>
<li>不能长期运行后台任务，该限制的具体细节因平台而异。(一个app extension能够使用NSURLSession对象启动一个上传或下载并将这些操作的结果返回给containing app)</li>
<li>不能使用Air Drop接收数据(一个app extension能够像一个正常的app一样通过UIActivityViewController class去使用AirDrop发送数据)</li>
</ul>
<p>还有更多不可用的 API 可以看这个苹果官方文档（以文档为主）：<a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=https://developer.apple.com/library/ios/documentation/General/Conceptual/ExtensibilityPG/ExtensionOverview.html#//apple_ref/doc/uid/TP40014214-CH2-SW2">Understand How an App Extension Works</a></p>
<h2 id="1-4-App-Extension-生命周期与交互"><a href="#1-4-App-Extension-生命周期与交互" class="headerlink" title="1.4  App Extension 生命周期与交互"></a>1.4  App Extension 生命周期与交互</h2><p>因为app extension不是一个app,它的生命周期和app是不同的，在大多情况下，当用户从app的UI上或者其他活动视图控制器中选择开启extension功能的选项时将会开始执行。</p>
<p>先说下几个概念:</p>
<ul>
<li>App : 就是我们正常手机里的每个应用程序，即Xcode运行后生成的程序。一个app可以包含一个或多个target,每个target将产生一个product.</li>
<li>App extension : 为了扩展特定app的功能并且依赖于一个特定的app的<strong>一条进程</strong>。</li>
<li>Containing app：一个app包含一个或多个extension称为containing app。</li>
<li>target : 在项目中新建一个target来创建app extension.任意一个target指定了应用程序中构建product的设置信息和文件。</li>
<li>host app : 包含app extension 并且能从中打开它(并不一定非要从此app内部打开，可以是app内部也可以是例如Today Widget外部控件)。</li>
</ul>
<p><code>host app</code> : 我们可以把它理解为<code>宿主的App</code>，能够调起extension的app被称为host app，比如：Safari app 里面网页分享到微信, Safari就是 host app ; widget的host app就是Today。</p>
<p>App Extension基本认知： </p>
<ul>
<li>Extension不能单独发布和部署，需要依赖于容器应用(Containing App)。</li>
<li>Extension和容器应用(Containing App)的生命周期是独立的，分别为两个不同的进程.</li>
<li>Extension的运行依赖于宿主应用(Host App)，生命周期由宿主应用决定。</li>
<li>Extension作为一个单独的target存在，但会随着容器应用(Containing App)的安装和卸载而安装和卸载。</li>
<li>Extension需要独立的证书用来打包和测试。</li>
</ul>
<h3 id="1-4-1-Extension的生命周期如下"><a href="#1-4-1-Extension的生命周期如下" class="headerlink" title="1.4.1 Extension的生命周期如下:"></a>1.4.1 Extension的生命周期如下:</h3><p><img src="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409165903.png"></p>
<p>调用起了 <code>Extension</code> ，操作完就退出</p>
<h3 id="1-4-2-Extension-与-App-交互"><a href="#1-4-2-Extension-与-App-交互" class="headerlink" title="1.4.2 Extension 与 App 交互"></a>1.4.2 Extension 与 App 交互</h3><p>一些简单的交互</p>
<p><img src="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409170336.png"></p>
<ul>
<li>app extension 和 containing app将不能够直接交互，典型的，containing app可能还没有开始运行然而它包含的app extension已经在运行了。（例如，一个天气的app,当你还没有打开它时，你可以在Today Widget中看到今天天气的信息）</li>
<li>在一个典型的请求响应事务中，系统代表的host app打开app extension, 通过host提供的extension上下文(context)传递数据, 这个extension通过界面的展示来执行一些任务，如果适用于extension的目的，返回数据给host.</li>
<li>上图的虚线代表了app extension 和 containing app之间有限的交互。例如Today widget(只有 Today Extension 才支持通过调用其他不可以) 通过调用 NSExtensionContext类中<code>openURL:completionHandler:</code>方法来要求系统去打开它的containing app.</li>
</ul>
<p>具体交互</p>
<p><img src="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409170633.png"></p>
<p>任意一个app extension和它的containing app能够在一个私有的shared container中分享数据。</p>
<h1 id="2-实战"><a href="#2-实战" class="headerlink" title="2. 实战"></a>2. 实战</h1><p><strong>要做的事情:</strong></p>
<p>使用 <code>Extensions</code> 难免会与<code>Containing App</code>有一定交互或者资源共享,首先列出了可能会遇到的情景:</p>
<h5 id="widget-和-主-App-共用资源"><a href="#widget-和-主-App-共用资源" class="headerlink" title="widget 和 主 App 共用资源"></a>widget 和 主 App 共用资源</h5><p>widget 和主 App 共享代码和资源。我们还是要尽可能的让 widget 和主 App 共享代码。因为没必要一份代码写2次，能复用就复用</p>
<p>主要有两个方案:</p>
<ul>
<li>framework</li>
<li>直接共享</li>
</ul>
<h5 id="widget-和-主-App-共享数据"><a href="#widget-和-主-App-共享数据" class="headerlink" title="widget 和 主 App 共享数据"></a>widget 和 主 App 共享数据</h5><p>严格来说 widget 和 App 是不同的两个 App 了, 而且他们之间有沙盒限制，他们之间要共享数据的话只能使用 <strong>App Groups</strong> 了。常用就是 <code>NSUserDefault</code>、<code>Core Data</code> 、<code>SQL</code></p>
<h3 id="2-1-创建项目的-Extension"><a href="#2-1-创建项目的-Extension" class="headerlink" title="2.1 创建项目的 Extension"></a>2.1 创建项目的 Extension</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">XCode</span> -&gt; File -&gt; New -&gt; Target</span><br></pre></td></tr></table></figure>

<p><img src="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409172331.png"></p>
<p><img src="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409172505.png"></p>
<p>选择 <code>Today Extension</code> , 项目名字随便取,当然最好就是你的跟你项目相关了,创建后可以看到，几个地方多了这个<code>Extension</code> 显示了:</p>
<p>项目中多了个文件夹，文件夹名字就是 <code>Extension</code> 命名的名字了</p>
<p><img src="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409173055.png"></p>
<p>target中多了 <code>Extension</code></p>
<p><img src="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409173138.png"></p>
<p>纵观一下文件， <code>TodayViewController</code>是 <code>Extension</code>主体文件了，业务逻辑也写在里面，默认新创建的<code>Extension</code>是使用 <code>.storyboard</code> 管理UI视图的，当然你不想用也行，只需要在 <code>Extension</code>里的 <code>info.plist</code>改下</p>
<p><img src="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409173435.png"></p>
<p>改 <code>NSExtensionMainStoryboard</code>字段为 <code>NSExtensionPrincipalClass</code> ，并修改入口为自定义类。</p>
<p>然后选择 scheme可以编译看下<code> helloworld</code> 效果了</p>
<p><img src="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409173749.png"></p>
<h3 id="2-2-Pod-的配置"><a href="#2-2-Pod-的配置" class="headerlink" title="2.2 Pod 的配置"></a>2.2 Pod 的配置</h3><p><code>Extension</code>开发中有时难免会用到一些第三方,如 <code>SDWebImage</code> 或者<code>AFNetworking</code>之类的，<code>Cocoapod</code> 也提供了这方面功能，能使 <code>Extension</code> 用上这些类,同理在 <code>Podfile</code> 中添加</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">target <span class="string">&#x27;TodayExtentsionDemo&#x27;</span> <span class="keyword">do</span></span><br><span class="line">    pod <span class="string">&#x27;AFNetworking&#x27;</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">target <span class="string">&#x27;TodayExtentsion&#x27;</span> <span class="keyword">do</span></span><br><span class="line">    pod <span class="string">&#x27;AFNetworking&#x27;</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">  <span class="comment"># target写 App 与 Extension 名字即可关联</span></span><br></pre></td></tr></table></figure>

<p>此时你也许会留意到，比如上面 <code>AF</code> 两个Target都要用到，都要重新写一次，会很麻烦。</p>
<p>是很麻烦，故此上网找了下相关解决方法，知道有个这个 <code>link_with</code> 方法，如下:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">link_with <span class="string">&#x27;TodayExtentsionDemo&#x27;</span>, <span class="string">&#x27;TodayExtentsion&#x27;</span></span><br><span class="line">	pod <span class="string">&#x27;AFNetworking&#x27;</span></span><br></pre></td></tr></table></figure>

<p>但是,这种方法已经弃用了, <code>Pod install</code>会报错,所以你看到网上介绍相关方法的文章，都是抄别人自己又不试的</p>
<p><img src="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409174457.png"></p>
<p>由于 <code>Cocoapod</code>是 <code>Ruby</code> 写的，我们可以这样子操作一下</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">shareFramework</span></span></span><br><span class="line">    pod <span class="string">&#x27;AFNetworking&#x27;</span></span><br><span class="line">    <span class="comment">#blablabla Framework</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">target <span class="string">&#x27;TodayExtentsionDemo&#x27;</span> <span class="keyword">do</span></span><br><span class="line">    shareFramework</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">target <span class="string">&#x27;TodayExtentsion&#x27;</span> <span class="keyword">do</span></span><br><span class="line">    shareFramework</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#定义了个Function，在里面添加通用的库</span></span><br></pre></td></tr></table></figure>

<p><code>Pod install</code>之后即可为每个 <code>Target</code> 引入相关库</p>
<blockquote>
<p>课外阅读: <a target="_blank" rel="noopener" href="https://juejin.im/entry/59dd94b06fb9a0451463030b">Cocoapods原理总结</a> </p>
</blockquote>
<p>此时，我们可以在 <code>Containning App</code> 与 <code>Extension</code>中使用 <code>AF</code>库了</p>
<h3 id="2-3-Extension-入门-UI-操作"><a href="#2-3-Extension-入门-UI-操作" class="headerlink" title="2.3 Extension 入门 UI 操作"></a>2.3 Extension 入门 UI 操作</h3><p>我们刚编译的 <code>Extension</code>  你会看到是没有展开按钮的，此时我们只需要在 <code>viewDidLoad</code> 中添加</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//这个iOS10以后的API，可以在Extension上显示 展开/收起 按钮, 至于iOS10 之前需要搞一个按钮手动触发改变高度?</span></span><br><span class="line"><span class="comment">//由于手上没有 iOS10 之前机子测试, 所以先挖个坑，迟点有了再补坑</span></span><br><span class="line"><span class="keyword">if</span> (@available(iOS <span class="number">10.0</span>, *)) &#123;</span><br><span class="line">        <span class="keyword">self</span>.extensionContext.widgetLargestAvailableDisplayMode = NCWidgetDisplayModeExpanded;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>添加了这句代码 之后，你会发现 <code>Extension</code>上有了折叠收起按钮了</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)widgetActiveDisplayModeDidChange:(NCWidgetDisplayMode)activeDisplayMode withMaximumSize:(<span class="built_in">CGSize</span>)maxSize &#123;</span><br><span class="line">    <span class="keyword">if</span> (activeDisplayMode == NCWidgetDisplayModeExpanded) &#123;</span><br><span class="line">        <span class="comment">// 设置展开的新高度</span></span><br><span class="line">      	<span class="comment">//最大只能 screen size - 139</span></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">self</span>.preferredContentSize = maxSize;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个是 <code>Extension</code>代理方法，用于回调点击了 收起/展开 按钮后，返回 显示区域的高度大小</p>
<p>经过一些测试，发现这个 <code>Extension</code>最大的高度只能是 屏幕高度 - 139. 超过了也是这么高</p>
<p>else 下的是收起高度，直接返回代理给你的系统 高度好了(没有特别要求的话)</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)widgetPerformUpdateWithCompletionHandler:(<span class="keyword">void</span> (^)(NCUpdateResult))completionHandler&#123;</span><br><span class="line">  <span class="comment">//blablabla</span></span><br><span class="line">  <span class="comment">//做vieWillAppear前数据获取之类的操作</span></span><br><span class="line">  <span class="comment">//或者系统每隔一段时间截取 Extension 图片时候调用的方法</span></span><br><span class="line">  	completionHandler(NCUpdateResultNewData);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>大致意思是建议你通过实现它的回调来获取数据，你也可以在viewwillappear中设置你的初始数据，但是希望你在获取到新数据时能平稳的过渡到新的数据来。并且它是在主线程更新。</p>
<p>当widget最初被创建时，widgetPerformUpdateWithCompletionHandler几乎被简单地调用，所以你可以在这里完成所有的加载，但是苹果建议你尽可能的在生命周期的早期开始加载过程。</p>
<p>如果您的小部件显示的信息永远不会更改，那么您不必在<code>widgetPerformUpdateWithCompletionHandler</code>中执行任何操作。</p>
<p>其实可以理解为 类似天气或者股票之类App，在用户使用时候，系统每隔一段时间会调用这个方法获取 <code>Extension</code>的快照，比如一段时间获得当前天气情况，更新<code>Extension</code>,下次你看到这个 <code>Extension</code>时候就是最新的天气了</p>
<h3 id="2-4-Extension-与-Containing-App-代码共享"><a href="#2-4-Extension-与-Containing-App-代码共享" class="headerlink" title="2.4 Extension 与 Containing App 代码共享"></a>2.4 Extension 与 Containing App 代码共享</h3><p><code>Extension</code>也有UI,也有业务逻辑，有时候跟项目一些流程相同，那么代码复用也是一个考虑的点。</p>
<p>由于 <code>Extension</code> 与 <code>Containing App</code> 不算同一个App且同一个进程，如果要代码共享，很多人会考虑直接拷贝一份代码放到 <code>Extension</code> 里面(即<code>Target</code>选多一个<code>Extension</code>),比如，我们 <code>Extension</code> 里面需要用到一个 <code>Tableview</code> 显示数据，<code>Containing App</code>中也有相应的 <code>Tableview</code> 用到这个 <code>Cell</code>,</p>
<p><img src="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409215150.png"></p>
<p>比如你在 <code>Extension</code> 里面引入这个类并且写逻辑，你会发现并不能通过编译，因为<code>Extension</code> 无法访问这个，此时最简单方法就是</p>
<p><img src="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409215449.png"></p>
<p>在 <code>Target Membership</code>中勾选 <code>Containning App</code> 与 <code>Extension</code> 即可</p>
<p>但是一个问题来了,比如你这个 Cell 还引用了其他类，其他类的 <code>Target Membership</code> 也是需要勾选的，这样一来，项目一大你不知道有哪些勾了和没勾。这只是其中一个小问题，</p>
<p>另外的问题就是.如果这个文件还是主程序的 <code>target</code>,只要改动一下，所属的target就被编译器标记为需要重新编译，这样整个App就需要重新编译(当然你Run也是重新编译一次)，但是如果你用下面所说的 <code>framework</code> 苹果推荐方法，只需要编译<code>framework</code>里面的文件，达到组件化。我们知道<code>cocoapod</code> 也是将第三方库编译成 <code>framework</code>避免每次编译App也编译这部分东西的.</p>
<p>具体原理可以参考下面 文章  <a target="_blank" rel="noopener" href="https://www.appcoda.com.tw/framework/">用 Framework 重構 Swift 程式碼　大大提高編譯效率！</a></p>
<p>做法如下:</p>
<p>首先在新建一个  <code>Framework</code>:</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">XCode</span> -&gt; File -&gt; New -&gt; Target</span><br></pre></td></tr></table></figure>



<p><img src="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409220738.png"></p>
<p><img src="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409220848.png"></p>
<p>通常 <code>Framework</code> 都以 <code>xxxkit</code>结尾作为标准规范,新建完成后会发现架构中多了这个<code>Framework</code>文件夹以及 <code>Target</code> 中多了一个(情况如上面新建<code>Extension</code>一样，不做更多截图)</p>
<p>第二 , 在<code>Containning App</code>的 <code>Target</code>中删除共用代码的文件</p>
<p><img src="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409221138.png"></p>
<p>然后再 <code>Framework</code>的 <code>Complie Sources</code> 添加这个共用类</p>
<p><img src="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409221227.png"></p>
<p>最后，在 <code>Extension</code> 中添加 <code>Link Binary With Libraries</code></p>
<p><img src="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409221323.png"></p>
<p>这样既可完成 <code>Extension</code> 与 <code>Containing App</code> 共用类的编译以及运行</p>
<p><strong>如何解决警告linking against dylib not safe for use in application extensions</strong>:</p>
<p>因为app extension限制了某些API的使用， ( <a target="_blank" rel="noopener" href="https://developer.apple.com/library/prerelease/ios/documentation/General/Conceptual/ExtensibilityPG/ExtensionOverview.html#//apple_ref/doc/uid/TP40014214-CH2-SW6">App Extensions不能使用的一些API</a> ) ，因此在自定义自己的framework后，这个framework可能包含了某些在App Extensions里不能使用的API，因此为了安全起见才会给出这个警告。</p>
<p>选中自定义framework的target,然后选中Build Settings，（记住选择All,而不是Basic),在过滤框中输入”require only”，将<code>Require Only App-Extension-Safe API</code>的值改成YES，（默认为NO)，然后Command + K clean一下工程，警告久消除了。</p>
<p><img src="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190409184143.png"></p>
<h3 id="2-5-Widget-调用-Containing-App"><a href="#2-5-Widget-调用-Containing-App" class="headerlink" title="2.5 Widget 调用 Containing App"></a>2.5 Widget 调用 Containing App</h3><p>这个跟 urlScheme 设置一样，主要就是因为 <code>Extension</code>不能调用 <code>[UIApplication sharedApplication] </code> 所以正确做法是</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">self</span>.extensionContext openURL:&lt;#(<span class="keyword">nonnull</span> <span class="built_in">NSURL</span> *)#&gt; completionHandler:&lt;#^(<span class="built_in">BOOL</span> success)completionHandler#&gt;</span><br></pre></td></tr></table></figure>

<p>这里不做更多叙述，可以通过URL传递参数，APP动态路由处理即可</p>
<h3 id="2-6-Widget-与-Containing-App-数据共通"><a href="#2-6-Widget-与-Containing-App-数据共通" class="headerlink" title="2.6 Widget 与 Containing App 数据共通"></a>2.6 Widget 与 Containing App 数据共通</h3><p>严格来说 widget 和 App 是不同的两个 App 了, 他们之间要共享数据的话只能使用 <strong>App Groups</strong> 了。</p>
<p>具体做法忽略，暂时用个人开发者账户，之前创建的 AppGroup 发现不能删除..等上了公司证书再补坑</p>
<p>最后附上 Demo 地址 : <a target="_blank" rel="noopener" href="https://github.com/swlfigo/someDemo/tree/master/TodayExtentsionDemo">Demo</a></p>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/bbc6a95d9c54">1.揭秘 iOS App Extension 开发 —— Today 篇</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/9cd45d0b3697">2.App extension 总结</a></p>
<p><a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ExtensibilityPG/index.html#//apple_ref/doc/uid/TP40014214-CH20-SW1">3.App Extensions Increase Your Impact</a></p>
<p><a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ExtensibilityPG/ExtensionOverview.html#//apple_ref/doc/uid/TP40014214-CH2-SW2">4.Understand How an App Extension Works</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.im/entry/59dd94b06fb9a0451463030b">5.Cocoapods原理总结</a> </p>
<p><a target="_blank" rel="noopener" href="https://www.appcoda.com.tw/framework/">6.用 Framework 重構 Swift 程式碼　大大提高編譯效率！</a></p>
</div><div class="article-licensing box"><div class="licensing-title"><p>iOS Extentsion 入门实战</p><p><a href="https://swlfigo.github.io/posts/6244/">https://swlfigo.github.io/posts/6244/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>Sylar</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2019-04-28</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2021-04-12</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a class="icon" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a><a class="icon" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags size-small mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/iOS/">iOS</a></div><div class="sharethis-inline-share-buttons"></div><script src="//platform-api.sharethis.com/js/sharethis.js#property=5e09772c1fb40b0012b7b886&amp;product=inline-share-buttons&amp;cms=sop" defer></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">Like this article? Support the author with</h3><div class="buttons is-centered"><a class="button is-success donate"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>Wechat</span><span class="qrcode"><img src="http://sylarimage.oss-cn-shenzhen.aliyuncs.com/2019-12-30-032948.png" alt="Wechat"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/posts/68fd/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">GCD学习</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/posts/5222/"><span class="level-item">高性能iOS应用开发</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">Comments</h3><div class="content" id="valine-thread"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js"></script><script>new Valine({
            el: '#valine-thread' ,
            appId: "qwfDlFFyjoqLxsvp6wMSrQrN-gzGzoHsz",
            appKey: "RTXYfbUeLWuXXJe9cjRX7fJC",
            placeholder: "Type something slowly...",
            avatar: "mm",
            
            meta: ["nick","mail","link"],
            pageSize: 10,
            lang: "en",
            
            highlight: true,
            
            
            
            
            
            requiredFields: [],
        });</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="http://sylarimage.oss-cn-shenzhen.aliyuncs.com/2019-07-25-032947.jpg" alt="Sylar"></figure><p class="title is-size-4 is-block line-height-inherit">Sylar</p><p class="is-size-6 is-block">一个不会iOS的搬砖工</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>GuangZhou,China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">30</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">6</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">6</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/swlfigo" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/swlfigo"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Instagram" href="https://www.instagram.com/sylar.su/"><i class="fab fa-instagram"></i></a></div></div></div><!--!--><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile is-mobile" href="http://roadmap.isylar.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">iOS-RoadMap</span></span><span class="level-right"><span class="level-item tag">roadmap.isylar.com</span></span></a></li><li><a class="level is-mobile is-mobile" href="http://tech.isylar.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Tech-Tips</span></span><span class="level-right"><span class="level-item tag">tech.isylar.com</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/Hackintosh/"><span class="level-start"><span class="level-item">Hackintosh</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Hexo/"><span class="level-start"><span class="level-item">Hexo</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Metal/"><span class="level-start"><span class="level-item">Metal</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Note/"><span class="level-start"><span class="level-item">Note</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/iOS/"><span class="level-start"><span class="level-item">iOS</span></span><span class="level-end"><span class="level-item tag">20</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/iOS/ReactiveCocoa/"><span class="level-start"><span class="level-item">ReactiveCocoa</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li></ul></div></div></div><div class="card widget"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content size-small"><p><time dateTime="2021-04-12T10:09:02.000Z">2021-04-12</time></p><p class="title is-6"><a class="link-muted" href="/posts/undefined/">hackintoshEthernetProblem</a></p><p class="is-uppercase"></p></div></article><article class="media"><a class="media-left" href="/posts/2178376574/"><p class="image is-64x64"><img class="fill" src="/gallery/gcd-in-swift-thumbnail.jpeg" alt="gcd-in-swift"></p></a><div class="media-content size-small"><p><time dateTime="2020-09-21T09:15:48.000Z">2020-09-21</time></p><p class="title is-6"><a class="link-muted" href="/posts/2178376574/">gcd-in-swift</a></p><p class="is-uppercase"></p></div></article><article class="media"><a class="media-left" href="/posts/4106057131/"><p class="image is-64x64"><img class="fill" src="https://images.unsplash.com/photo-1581878811201-7d951612a47d?ixlib=rb-1.2.1&amp;ixid=eyJhcHBfaWQiOjEyMDd9&amp;auto=format&amp;fit=crop&amp;w=2134&amp;q=80" alt="bitcode"></p></a><div class="media-content size-small"><p><time dateTime="2020-02-16T11:31:55.000Z">2020-02-16</time></p><p class="title is-6"><a class="link-muted" href="/posts/4106057131/">bitcode</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/iOS/">iOS</a></p></div></article><article class="media"><a class="media-left" href="/posts/2261601169/"><p class="image is-64x64"><img class="fill" src="http://sylarimage.oss-cn-shenzhen.aliyuncs.com/2020-02-05-135324.jpg" alt="iOS LaunchScreen 适配与缓存踩坑"></p></a><div class="media-content size-small"><p><time dateTime="2020-02-05T13:54:30.000Z">2020-02-05</time></p><p class="title is-6"><a class="link-muted" href="/posts/2261601169/">iOS LaunchScreen 适配与缓存踩坑</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/iOS/">iOS</a></p></div></article><article class="media"><a class="media-left" href="/posts/3684286012/"><p class="image is-64x64"><img class="fill" src="http://sylarimage.oss-cn-shenzhen.aliyuncs.com/2019-12-30-092847.jpg" alt="iOS-NSDate"></p></a><div class="media-content size-small"><p><time dateTime="2019-11-19T06:39:15.000Z">2019-11-19</time></p><p class="title is-6"><a class="link-muted" href="/posts/3684286012/">iOS-NSDate</a></p><p class="is-uppercase"></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2021/04/"><span class="level-start"><span class="level-item">April 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/09/"><span class="level-start"><span class="level-item">September 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/02/"><span class="level-start"><span class="level-item">February 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/11/"><span class="level-start"><span class="level-item">November 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/10/"><span class="level-start"><span class="level-item">October 2019</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/09/"><span class="level-start"><span class="level-item">September 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/04/"><span class="level-start"><span class="level-item">April 2019</span></span><span class="level-end"><span class="level-item tag">21</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Hackintosh/"><span class="tag">Hackintosh</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Hexo/"><span class="tag">Hexo</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Metal/"><span class="tag">Metal</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Note/"><span class="tag">Note</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ReactiveCocoa/"><span class="tag">ReactiveCocoa</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/iOS/"><span class="tag">iOS</span><span class="tag is-grey-lightest">20</span></a></div></div></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe for updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button is-primary" type="submit" value="Subscribe"></div></div></form></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="Nevermore" height="28"></a><p class="size-small"><span>&copy; 2021 Sylar</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Follow me on GitHub" href="https://github.com/swlfigo"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" async></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"live2d-widget-model-wanko"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":true}});</script></body></html>